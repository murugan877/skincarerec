<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skin Care Recommender System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.12.0/dist/tf.min.js"></script>
    <style>
        :root {
            --primary-color: #ff4b4b;
            --secondary-color: #4b9bff;
            --accent-color: #ff9f43;
            --light-bg: #f8f9fa;
            --dark-text: #333;
            --light-text: #fff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: var(--dark-text);
            background-color: #fef6f6;
        }
        
        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background-color: var(--light-bg);
            border-radius: 8px;
            padding: 10px;
            box-shadow: var(--shadow);
        }
        
        .nav-item {
            padding: 10px 20px;
            cursor: pointer;
            text-align: center;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .nav-item:hover {
            border-bottom: 3px solid var(--primary-color);
            transform: translateY(-3px);
        }
        
        .nav-item.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .nav-item i {
            margin-right: 8px;
            transition: var(--transition);
        }
        
        .nav-item:hover i {
            transform: scale(1.2);
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(255, 75, 75, 0.1), transparent);
            transform: translateY(100%);
            transition: var(--transition);
            z-index: -1;
        }
        
        .nav-item:hover::after {
            transform: translateY(0);
        }
        
        /* Main content styles */
        h1 {
            color: var(--primary-color);
            text-align: center;
            position: relative;
            padding-bottom: 15px;
            animation: fadeIn 0.8s ease-out;
        }
        
        h1::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            border-radius: 3px;
        }
        
        .divider {
            border-top: 1px solid #ddd;
            margin: 20px 0;
            opacity: 0;
            animation: fadeIn 0.8s ease-out 0.3s forwards;
        }
        
        .columns {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            animation: slideUp 0.6s ease-out;
        }
        
        .column {
            flex: 1;
            transition: var(--transition);
        }
        
        .column:hover {
            transform: translateY(-5px);
        }
        
        select, input, button {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }
        
        select:focus, input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 75, 75, 0.2);
            outline: none;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            padding: 12px;
            position: relative;
            overflow: hidden;
            transition: var(--transition);
        }
        
        button:hover {
            background-color: #e03e3e;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(1px);
        }
        
        button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        
        button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        
        .multiselect {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 15px;
            background: white;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .multiselect:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .multiselect label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        #image-upload-container {
            border: 2px dashed #ddd;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            transition: var(--transition);
            background: white;
            box-shadow: var(--shadow);
            cursor: pointer;
        }
        
        #image-upload-container:hover {
            border-color: var(--primary-color);
            background: rgba(255, 75, 75, 0.05);
        }
        
        #image-upload {
            display: none;
        }
        
        #image-upload-container label {
            display: block;
            padding: 15px;
            background: var(--light-bg);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        #image-upload-container label:hover {
            background: rgba(75, 155, 255, 0.1);
        }
        
        #analyze-btn {
            background-color: var(--secondary-color);
            margin-top: 15px;
        }
        
        #analyze-btn:hover {
            background-color: #3a8aee;
        }
        
        .multiselect-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .multiselect-options label {
            display: flex;
            align-items: center;
            background: #f0f0f0;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 0;
            font-weight: normal;
        }
        
        .multiselect-options label:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }
        
        .multiselect-options input {
            width: auto;
            margin-right: 8px;
        }
        
        .recommendations {
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out;
        }
        
        video {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        video:hover {
            transform: scale(1.01);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.6s ease-out;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .info-box {
            background-color: #e7f4ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid var(--secondary-color);
            box-shadow: var(--shadow);
            animation: slideInLeft 0.6s ease-out;
        }
        
        img {
            max-width: 100%;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        img:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        /* Recommendation items */
        .recommendations img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
            transition: var(--transition);
        }
        
        .recommendation-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            align-items: flex-start;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            animation: slideUp 0.5s ease-out;
            animation-fill-mode: both;
        }
        
        .recommendation-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .recommendation-image {
            flex: 0 0 100px;
            height: 100px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow);
        }
        
        .recommendation-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: var(--transition);
        }
        
        .recommendation-image:hover img {
            transform: scale(1.1);
        }
        
        .recommendation-image::before {
            content: "No Image";
            position: absolute;
            color: #999;
            font-size: 12px;
            display: none;
        }
        
        .recommendation-image.no-image::before {
            display: block;
        }
        
        .recommendation-content {
            flex: 1;
        }
        
        .recommendation-price {
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }
        .loading {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    margin-right: 8px;
    vertical-align: middle;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}
        #recommendationResults {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            box-shadow: var(--shadow);
            border-radius: 8px;
            overflow: hidden;
        }
        
        #recommendationResults th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
            position: sticky;
            top: 0;
        }
        
        #recommendationResults td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
            transition: var(--transition);
        }
        
        #recommendationResults tr {
            background: white;
            transition: var(--transition);
        }
        
        #recommendationResults tr:nth-child(even) {
            background: #f9f9f9;
        }
        
        #recommendationResults tr:hover {
            background: #f1f1f1;
            transform: translateX(5px);
        }
        
        #recommendationResults a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
            transition: var(--transition);
            position: relative;
        }
        
        #recommendationResults a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-color);
            transition: var(--transition);
        }
        
        #recommendationResults a:hover {
            color: #e03e3e;
        }
        
        #recommendationResults a:hover::after {
            width: 100%;
        }
        
        .price {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .sort-btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            box-shadow: var(--shadow);
        }
        
        .sort-btn:hover {
            background-color: #3a8aee;
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .sort-btn i {
            margin-right: 8px;
        }
        
        /* Skin Care 101 section */
        #skin-care-101 h3 {
            color: var(--primary-color);
            margin-top: 25px;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
            position: relative;
            animation: fadeIn 0.6s ease-out;
        }
        
        #skin-care-101 h3::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 50px;
            height: 2px;
            background: var(--primary-color);
        }
        
        #skin-care-101 p {
            margin-bottom: 15px;
            line-height: 1.6;
            animation: fadeIn 0.8s ease-out;
        }
        
        /* Skin Classifier section */
        #classification-results {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            animation: fadeIn 0.8s ease-out;
        }
        
        #skin-type-result {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
            animation: bounceIn 0.8s ease-out;
        }
        
        #skin-type-description {
            margin-top: 15px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--secondary-color);
            animation: fadeIn 1s ease-out;
        }
        
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from { 
                opacity: 0;
                transform: translateX(-20px);
            }
            to { 
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 1;
            }
            20% {
                transform: scale(25, 25);
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes float {
            0% {
                transform: translateY(0px);
            }
            50% {
                transform: translateY(-10px);
            }
            100% {
                transform: translateY(0px);
            }
        }
        
        /* Floating animation for product cards */
        .floating {
            animation: float 4s ease-in-out infinite;
        }
        
        /* Pulse animation for important elements */
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .columns {
                flex-direction: column;
            }
            
            .navbar {
                flex-wrap: wrap;
            }
            
            .nav-item {
                flex: 1 0 45%;
                margin-bottom: 5px;
            }
            
            #recommendationResults {
                display: block;
                overflow-x: auto;
            }
        }
        
        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: var(--primary-color);
            opacity: 0;
            z-index: 9999;
            animation: confettiFall 5s linear forwards;
        }
        
        @keyframes confettiFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Tooltip styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }
        
        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Floating action button */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.25);
        }
        .multiselect-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center; /* Add this to vertically center items */
}

.multiselect-options label {
    display: flex;
    align-items: center; /* Center checkbox and text vertically */
    background: #f0f0f0;
    padding: 8px 15px;
    border-radius: 20px;
    cursor: pointer;
    transition: var(--transition);
    margin-bottom: 0;
    font-weight: normal;
    line-height: 1; /* Ensure consistent line height */
}

.multiselect-options input[type="checkbox"] {
    margin-right: 8px;
    width: 16px; /* Fixed width */
    height: 16px; /* Fixed height */
    flex-shrink: 0; /* Prevent checkbox from shrinking */
}
    </style>
</head>
<body>
    <!-- Floating action button -->
    <div class="fab" id="help-fab">
        <i class="fas fa-question"></i>
    </div>
    
    <div class="navbar">
        <div class="nav-item active" data-tab="skin-care">
            <i class="fas fa-home"></i> Skin Care
        </div>
        <div class="nav-item" data-tab="recommendation">
            <i class="fas fa-star"></i> Get Recommendation
        </div>
        <div class="nav-item" data-tab="skin-care-101">
            <i class="fas fa-book"></i> Skin Care 101
        </div>
        <div class="nav-item" data-tab="skin-classifier">
            <i class="fas fa-camera"></i> Skin Classifier
        </div>
    </div>

    <!-- Skin Care Tab -->
    <div id="skin-care" class="tab-content active">
        <h1>Skin Care Product Recommender âœ¨</h1>
        <div class="divider"></div>
        
        <p><strong>The Skin Care Product Recommender Application is an implementation of Machine Learning that can provide skin care product recommendations according to your skin type and concerns</strong></p>
        
        <video controls class="floating">
            <source src="skincare.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
        
        <p><strong>You will get skin care product recommendations from various cosmetic brands with a total of 1200+ products tailored to your skin's needs.</strong></p>
        <p><strong>There are 5 categories of skin care products for 5 different skin types, along with concerns and benefits you want from the products. This recommender system is only a tool that provides recommendations based on the data you input, not scientific consultation.</strong></p>
        <p><strong>Please select the Get Recommendation page to start getting recommendations or select the Skin Care 101 page for skin care tips and tricks</strong></p>
        
        <p><strong>Happy Trying :) !</strong></p>
        
    </div>

    <!-- Get Recommendation Tab -->
    <div id="recommendation" class="tab-content">
        <h1>Let's Get Recommendation</h1>
        
        <p><strong>To get recommendations, please enter your skin type, concerns, and desired benefits to get the right skin care product recommendations</strong></p>
        
        <div class="divider"></div>

        <div class="columns">
            <div class="column">
                <label for="category">Product Category:</label>
                <select id="category">
                    <option value="">Select Category</option>
                </select>
            </div>
            <div class="column">
                <label for="skinType">Your Skin Type:</label>
                <select id="skinType">
                    <option value="Normal">Normal</option>
                    <option value="Dry">Dry</option>
                    <option value="Oily">Oily</option>
                    <option value="Combination">Combination</option>
                    <option value="Sensitive">Sensitive</option>
                </select>
            </div>
        </div>
        
        <div class="multiselect">
            <label>Skin Problems:</label>
            <div class="multiselect-options">
                <label><input type="checkbox" value="Dull Skin"> Dull Skin</label>
                <label><input type="checkbox" value="Acne"> Acne</label>
                <label><input type="checkbox" value="Acne Scars"> Acne Scars</label>
                <label><input type="checkbox" value="Large Pores"> Large Pores</label>
                <label><input type="checkbox" value="Dark Spots"> Dark Spots</label>
                <label><input type="checkbox" value="Fine Lines & Wrinkles"> Fine Lines & Wrinkles</label>
                <label><input type="checkbox" value="Blackheads"> Blackheads</label>
                <label><input type="checkbox" value="Uneven Skin Tone"> Uneven Skin Tone</label>
                <label><input type="checkbox" value="Redness"> Redness</label>
                <label><input type="checkbox" value="Sagging Skin"> Sagging Skin</label>
            </div>
        </div>
        
        <div id="notableEffectsContainer" class="multiselect">
            <label>Notable Effects:</label>
            <div id="notableEffects" class="multiselect-options">
                <!-- Options will be populated by JavaScript -->
            </div>
        </div>
        
        <label for="product">Recommended Products For You:</label>
        <select id="product">
            <option value="">Select Product</option>
        </select>

        <button id="recommendBtn">Find Other Recommended Products! <span id="loading" class="loading" style="display:none;"></span></button>
        
        <div id="recommendations" class="recommendations" style="display: none;">
            <h3>Here Are Other Similar Product Recommendations According to Your Needs</h3>
            <div style="margin-bottom: 20px;">
                <button class="sort-btn" data-sort="price"><i class="fas fa-dollar-sign"></i> Sort by Price</button>
                <button class="sort-btn" data-sort="brand"><i class="fas fa-tag"></i> Sort by Brand</button>
                <button class="sort-btn" data-sort="name"><i class="fas fa-sort-alpha-down"></i> Sort by Name</button>
            </div>
            <table id="recommendationResults">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Brand</th>
                        <th>Price</th>
                        <th>Description</th>
                        <th>Link</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- Skin Care 101 Tab -->
    <div id="skin-care-101" class="tab-content">
        <h1>Take a Look at Skin Care 101</h1>
        <div class="divider"></div>
        
        <p><strong>Here are tips and tricks you can follow to maximize the use of skin care products</strong></p>
        
        <img src="imagepic.jpg" alt="Skin Care 101" class="floating">
        
        <h3>1. Facial Wash</h3>
        <p><strong>- Use facial wash products that have been recommended or that already suit you</strong></p>
        <p><strong>- Wash your face maximum twice a day, in the morning and at night before bed. Washing your face too often will remove the skin's natural oils. For those with dry skin, it's okay to just use plain water in the morning</strong></p>
        <p><strong>- Don't scrub your face harshly as it can remove the skin's natural protection</strong></p>
        <p><strong>- The best way to clean your skin is to use your fingertips for 30-60 seconds with circular and massaging motions</strong></p>
        
        <h3>2. Toner</h3>
        <p><strong>- Use toner that has been recommended or that already suits you</strong></p>
        <p><strong>- Pour toner onto a cotton pad and gently swipe it on your face. For better results, use 2 layers of toner - the first with a cotton pad and the last with your hands for better absorption</strong></p>
        <p><strong>- Use toner right after washing your face</strong></p>
        <p><strong>- For those with sensitive skin, try to avoid skin care products containing fragrance</strong></p>
        
        <h3>3. Serum</h3>
        <p><strong>- Use serum that has been recommended or that already suits you for better results</strong></p>
        <p><strong>- Serum should be used after your face is completely clean so its ingredients can absorb perfectly</strong></p>
        <p><strong>- Use serum in the morning and at night before bed</strong></p>
        <p><strong>- Choose serum according to your needs like removing acne scars, dark spots, anti-aging, or other benefits</strong></p>
        <p><strong>- The way to apply serum for better absorption is to pour it onto your palms then pat it gently on your face and wait until it's absorbed</strong></p>
        
        <h3>4. Moisturizer</h3>
        <p><strong>- Use moisturizer that has been recommended or that already suits you for better results</strong></p>
        <p><strong>- Moisturizer is a must-have skin care product because it can lock in moisture and various nutrients from the serum you've used</strong></p>
        <p><strong>- For better results, use different moisturizers in the morning and at night. Morning moisturizers usually contain sunscreen and vitamins to protect skin from UV rays and pollution, while night moisturizers contain various active ingredients that help skin regeneration during sleep</strong></p>
        <p><strong>- Leave a gap of about 2-3 minutes between using serum and moisturizer to ensure the serum has been absorbed into the skin</strong></p>
        
        <h3>5. Sunscreen</h3>
        <p><strong>- Use sunscreen that has been recommended or that already suits you for better results</strong></p>
        <p><strong>- Sunscreen is the key to all skin care products because it protects skin from the harmful effects of UVA and UVB rays, even blue light. All skin care products won't show their benefits if there's nothing protecting the skin</strong></p>
        <p><strong>- Use sunscreen approximately the length of your index and middle fingers to maximize protection</strong></p>
        <p><strong>- Re-apply sunscreen every 2-3 hours or as needed</strong></p>
        <p><strong>- Keep using sunscreen even when indoors because sunlight after 10 AM still penetrates through windows and during cloudy weather</strong></p>
        
        <h3>6. Don't frequently change skin care products</h3>
        <p><strong>Frequently changing skin care products will cause skin stress because it has to adapt to product ingredients. As a result, the benefits won't be 100% effective. Instead, use skin care products for months to see the results</strong></p>
        
        <h3>7. Be Consistent</h3>
        <p><strong>The key to facial care is consistency. Be diligent and persistent in using skin care products because the results aren't instant</strong></p>
        
        <h3>8. Your face is an asset</h3>
        <p><strong>Human appearances are gifts from the Creator. Take care of that gift well and sincerely as a form of gratitude. Choose products and care methods that suit your skin's needs. Using skin care products from an early age is like investing in your future.</strong></p>
    </div>

    <div id="skin-classifier" class="tab-content">
        <h1>Skin Type Classifier</h1>
        <div class="divider"></div>
        
        <p><strong>Upload a photo of your face to determine your skin type and get personalized recommendations</strong></p>
        
        <div class="columns">
            <div class="column">
                <div id="image-upload-container">
                    <input type="file" id="image-upload" accept="image/*" capture="camera">
                    <label for="image-upload">
                        <i class="fas fa-camera" style="font-size: 24px; margin-bottom: 10px;"></i><br>
                        Click to upload photo or take a photo (JPG, PNG or 5MB)
                    </label>
                    <div id="image-preview-container" style="display: none; margin-top: 20px; text-align: center;">
                        <img id="image-preview" style="max-width: 300px; max-height: 300px; display: block; margin: 0 auto; background: #f5f5f5;">
                        <button id="remove-image-btn" style="margin-top: 10px; background: #ff4b4b; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            Remove Image
                        </button>
                        <button id="analyze-btn" style="margin-top: 15px; width: auto; padding: 10px 20px;">
                            Analyze Skin
                        </button>
                    </div>
                </div>
            </div>
            <div class="column">
                <div id="classification-results" style="display: none;">
                    <h3>Your Skin Type:</h3>
                    <div id="skin-type-result" style="font-size: 24px; font-weight: bold; color: #ff4b4b;"></div>
                    <div id="skin-type-description" style="margin-top: 10px;"></div>
                    
                    <h3 style="margin-top: 20px;">Recommended Products:</h3>
                    <div id="classified-recommendations"></div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0/dist/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
    // Global variables
    let skincareData = [];
    let cosineSim = null;
    let skinModel = null;
    let isModelLoading = false;
    let isAnalyzing = false;

    // Tab switching functionality
    function setupTabs() {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remove active class from all nav items and tabs
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                
                // Add active class to clicked nav item and corresponding tab
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                if (tabId) {
                    const tabElement = document.getElementById(tabId);
                    if (tabElement) {
                        tabElement.classList.add('active');
                    }
                }
            });
        });
    }

    // Load CSV data
    function loadCSVData() {
        fetch('export_skincare.csv')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load CSV file');
                }
                return response.text();
            })
            .then(csvData => {
                // Parse CSV data
                Papa.parse(csvData, {
                    header: true,
                    complete: function(results) {
                        if (results.data && results.data.length > 0) {
                            skincareData = results.data.filter(item => item.product_name);
                            initializeApp();
                        } else {
                            throw new Error('No valid data found in CSV');
                        }
                    },
                    error: function(error) {
                        throw new Error('Error parsing CSV: ' + error.message);
                    }
                });
            })
            .catch(error => {
                console.error('Error loading CSV:', error);
                alert('Error loading product data: ' + error.message);
            });
    }

    // Initialize app after data is loaded
    function initializeApp() {
        try {
            // Populate product categories
            populateCategories();
            
            // Initialize recommendation engine
            initializeRecommendationEngine();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set up tabs
            setupTabs();
            
            console.log('App initialized successfully');
        } catch (error) {
            console.error('Error initializing app:', error);
            alert('Error initializing application: ' + error.message);
        }
    }

    // Populate product categories dropdown
    function populateCategories() {
        const categorySelect = document.getElementById('category');
        if (!categorySelect) return;
        
        categorySelect.innerHTML = '<option value="">Select Category</option>';
        
        const categories = [...new Set(skincareData.map(item => item.product_type))].filter(Boolean);
        if (categories.length === 0) {
            console.warn('No categories found in data');
            return;
        }
        
        categories.forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
    }

    // Initialize recommendation engine
    function initializeRecommendationEngine() {
        try {
            if (!skincareData || skincareData.length === 0) {
                throw new Error('No skincare data available');
            }
            
            // Extract notable effects for TF-IDF
            const allEffects = new Set();
            const effectDocuments = [];
            
            skincareData.forEach(item => {
                const effects = (item.notable_effects || '').split(',').map(e => e.trim()).filter(Boolean);
                effects.forEach(effect => allEffects.add(effect));
                effectDocuments.push(effects);
            });
            
            const effectList = Array.from(allEffects);
            if (effectList.length === 0) {
                console.warn('No notable effects found in data');
                return;
            }
            
            // Calculate TF-IDF matrix
            const tfidfMatrix = effectDocuments.map(effects => {
                const row = new Array(effectList.length).fill(0);
                
                // Calculate term frequency
                effects.forEach(effect => {
                    const index = effectList.indexOf(effect);
                    if (index !== -1) {
                        row[index] += 1;
                    }
                });
                
                // Normalize by max frequency in document
                const maxFreq = Math.max(...row);
                if (maxFreq > 0) {
                    for (let i = 0; i < row.length; i++) {
                        row[i] = row[i] / maxFreq;
                    }
                }
                
                return row;
            });
            
            // Calculate cosine similarity matrix
            cosineSim = new Array(skincareData.length);
            for (let i = 0; i < skincareData.length; i++) {
                cosineSim[i] = new Array(skincareData.length);
                for (let j = 0; j < skincareData.length; j++) {
                    cosineSim[i][j] = cosineSimilarity(tfidfMatrix[i], tfidfMatrix[j]);
                }
            }
            
            console.log('Recommendation engine initialized');
        } catch (error) {
            console.error('Error initializing recommendation engine:', error);
            throw error;
        }
    }

    // Calculate cosine similarity between two vectors
    function cosineSimilarity(vecA, vecB) {
        if (!vecA || !vecB || vecA.length !== vecB.length) {
            return 0;
        }
        
        let dotProduct = 0;
        let normA = 0;
        let normB = 0;
        
        for (let i = 0; i < vecA.length; i++) {
            dotProduct += vecA[i] * vecB[i];
            normA += vecA[i] * vecA[i];
            normB += vecB[i] * vecB[i];
        }
        
        normA = Math.sqrt(normA);
        normB = Math.sqrt(normB);
        
        if (normA === 0 || normB === 0) {
            return 0;
        }
        
        return dotProduct / (normA * normB);
    }

    // Get skincare recommendations
    function skincareRecommendations(productName, k = 5) {
        try {
            if (!skincareData || !cosineSim) {
                throw new Error('Recommendation engine not initialized');
            }
            
            // Find product index
            const productIndex = skincareData.findIndex(item => item.product_name === productName);
            if (productIndex === -1) {
                throw new Error('Product not found');
            }
            
            // Get similarity scores for this product
            const similarityScores = cosineSim[productIndex];
            
            // Create array of indices and sort by similarity
            const indices = similarityScores.map((score, index) => ({score, index}));
            indices.sort((a, b) => b.score - a.score);
            
            // Get top k+1 recommendations (excluding the product itself)
            const topIndices = indices.slice(1, k + 1).map(item => item.index);
            
            // Return recommended products with all CSV fields
            return topIndices.map(index => {
                const product = skincareData[index];
                return {
                    product_href: product.product_href || '#',
                    product_name: product.product_name || 'Unknown Product',
                    product_type: product.product_type || 'Unknown Type',
                    brand: product.brand || 'Unknown Brand',
                    notable_effects: product.notable_effects || 'No notable effects',
                    price: product.price || 'Price not available',
                    description: product.description || 'No description available',
                    picture_src: product.picture_src || 'https://via.placeholder.com/100x100?text=No+Image',
                    labels: product.labels || '',
                    Sensitive: product.Sensitive || '0',
                    Combination: product.Combination || '0',
                    Oily: product.Oily || '0',
                    Dry: product.Dry || '0',
                    Normal: product.Normal || '0'
                };
            });
        } catch (error) {
            console.error('Error generating recommendations:', error);
            return [];
        }
    }

    // Update notable effects based on selected category and skin type
    function updateNotableEffects() {
        const category = document.getElementById('category')?.value;
        const skinType = document.getElementById('skinType')?.value;
        const container = document.getElementById('notableEffects');
        
        if (!container) return;
        container.innerHTML = '';
        
        if (category && skinType) {
            try {
                // Filter products by category and skin type
                const filteredProducts = skincareData.filter(item => 
                    item.product_type === category && 
                    item[skinType] === '1'
                );
                
                if (filteredProducts.length === 0) {
                    container.innerHTML = '<p>No products found for these filters</p>';
                    return;
                }
                
                // Get all unique notable effects
                const allEffects = new Set();
                filteredProducts.forEach(item => {
                    const effects = (item.notable_effects || '').split(',').map(e => e.trim()).filter(Boolean);
                    effects.forEach(effect => allEffects.add(effect));
                });
                
                // Add checkboxes for each effect
                if (allEffects.size === 0) {
                    container.innerHTML = '<p>No notable effects found for these products</p>';
                    return;
                }
                
                Array.from(allEffects).forEach(effect => {
                    const label = document.createElement('label');
                    label.className = 'effect-option';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `effect-${effect.replace(/\s+/g, '-')}`;
                    checkbox.value = effect;
                    
                    const span = document.createElement('span');
                    span.textContent = effect;
                    
                    label.appendChild(checkbox);
                    label.appendChild(span);
                    container.appendChild(label);
                });
            } catch (error) {
                console.error('Error updating notable effects:', error);
                container.innerHTML = '<p>Error loading effects</p>';
            }
        }
    }
    
    // Update product list based on selections
    function updateProductList() {
        const category = document.getElementById('category')?.value;
        const skinType = document.getElementById('skinType')?.value;
        const productSelect = document.getElementById('product');
        
        if (!productSelect) return;
        productSelect.innerHTML = '<option value="">Select Product</option>';
        
        if (category && skinType) {
            try {
                // Get selected notable effects
                const selectedEffects = [];
                document.querySelectorAll('#notableEffects input:checked').forEach(checkbox => {
                    selectedEffects.push(checkbox.value);
                });
                
                // Filter products
                let filteredProducts = skincareData.filter(item => 
                    item.product_type === category && 
                    item[skinType] === '1'
                );
                
                // Further filter by notable effects if any are selected
                if (selectedEffects.length > 0) {
                    filteredProducts = filteredProducts.filter(item => {
                        const itemEffects = (item.notable_effects || '').split(',').map(e => e.trim());
                        return selectedEffects.some(effect => itemEffects.includes(effect));
                    });
                }
                
                if (filteredProducts.length === 0) {
                    const option = document.createElement('option');
                    option.value = '';
                    option.textContent = 'No products match your filters';
                    productSelect.appendChild(option);
                    return;
                }
                
                // Add products to select
                filteredProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.product_name;
                    option.textContent = product.product_name;
                    productSelect.appendChild(option);
                });
            } catch (error) {
                console.error('Error updating product list:', error);
                const option = document.createElement('option');
                option.value = '';
                option.textContent = 'Error loading products';
                productSelect.appendChild(option);
            }
        }
    }

    // Generate recommendations
    async function generateRecommendations() {
        const product = document.getElementById('product')?.value;
        const results = document.getElementById('recommendationResults')?.querySelector('tbody');
        const container = document.getElementById('recommendations');
        const loading = document.getElementById('loading');
        const recommendBtn = document.getElementById('recommendBtn');
        
        if (!product || !results || !container || !loading || !recommendBtn) {
            alert('Required elements not found');
            return;
        }
        
        if (!product) {
            alert('Please select a product first');
            return;
        }
        
        // Show loading indicator
        loading.style.display = 'inline-block';
        recommendBtn.disabled = true;
        
        try {
            // Get recommendations
            const recommendations = await new Promise((resolve) => {
                setTimeout(() => {
                    resolve(skincareRecommendations(product));
                }, 500);
            });
            
            // Clear previous results
            results.innerHTML = '';
            
            if (recommendations.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5">No recommendations found for this product</td>';
                results.appendChild(row);
                return;
            }
            
            // Display results in table format with links and prices
            recommendations.forEach(rec => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${rec.product_name}</td>
                    <td>${rec.brand}</td>
                    <td class="price">${rec.price}</td>
                    <td>${rec.description}</td>
                    <td><a href="${rec.product_href}" target="_blank" rel="noopener noreferrer">View Product</a></td>
                `;
                results.appendChild(row);
            });
            
            container.style.display = 'block';
        } catch (error) {
            console.error('Error generating recommendations:', error);
            alert('Error generating recommendations: ' + error.message);
        } finally {
            // Hide loading indicator
            loading.style.display = 'none';
            recommendBtn.disabled = false;
        }
    }

    // Load skin classification model
    async function loadSkinModel() {
        if (isModelLoading || skinModel) return;
        isModelLoading = true;
        
        const analyzeBtn = document.getElementById('analyze-btn');
        if (analyzeBtn) analyzeBtn.disabled = true;
        
        try {
            // Check if TensorFlow.js is available
            if (typeof tf === 'undefined') {
                throw new Error('TensorFlow.js not loaded');
            }
            
            // Wait for TensorFlow.js to be ready
            await tf.ready();
            
            console.log("Loading skin classification model...");
            skinModel = await tf.loadLayersModel('https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json');
            console.log("Model loaded successfully");
            
            // Warm up the model
            const warmupResult = skinModel.predict(tf.zeros([1, 224, 224, 3]));
            await warmupResult.data();
            warmupResult.dispose();
            
            // Enable the file upload input
            const uploadInput = document.getElementById('image-upload');
            if (uploadInput) {
                uploadInput.addEventListener('change', handleImageUpload);
            }
        } catch (error) {
            console.error("Error loading model:", error);
            alert("Error loading skin classification model: " + error.message);
            // Fallback to simulated analysis
            skinModel = { 
                predict: () => ({ 
                    data: () => Promise.resolve(new Float32Array(1000)) 
                }) 
            };
        } finally {
            isModelLoading = false;
            if (analyzeBtn) analyzeBtn.disabled = false;
        }
    }

    // Sort recommendation results
    function sortRecommendations(sortBy) {
        const table = document.getElementById('recommendationResults');
        if (!table) return;
        
        const tbody = table.querySelector('tbody');
        if (!tbody) return;
        
        const rows = Array.from(tbody.querySelectorAll('tr'));
        if (rows.length === 0) return;
        
        rows.sort((a, b) => {
            const aValue = getSortValue(a, sortBy);
            const bValue = getSortValue(b, sortBy);
            
            if (sortBy === 'price') {
                // Extract numeric value from price (remove currency symbols)
                const aNum = parseFloat(aValue.replace(/[^0-9.]/g, '')) || 0;
                const bNum = parseFloat(bValue.replace(/[^0-9.]/g, '')) || 0;
                return aNum - bNum;
            } else {
                // String comparison for name and brand
                return aValue.localeCompare(bValue);
            }
        });
        
        // Clear and re-add sorted rows
        tbody.innerHTML = '';
        rows.forEach(row => tbody.appendChild(row));
    }

    // Helper function to get sort value from a row
    function getSortValue(row, sortBy) {
        const cells = row.querySelectorAll('td');
        switch (sortBy) {
            case 'price':
                return cells[2]?.textContent || '';
            case 'brand':
                return cells[1]?.textContent || '';
            case 'name':
            default:
                return cells[0]?.textContent || '';
        }
    }
    
    // Handle image upload
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        // Revoke previous object URL if exists
        const preview = document.getElementById('image-preview');
        if (preview && preview.src.startsWith('blob:')) {
            URL.revokeObjectURL(preview.src);
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            if (preview) {
                preview.src = e.target.result;
                const previewContainer = document.getElementById('image-preview-container');
                if (previewContainer) previewContainer.style.display = 'block';
            }
        };
        reader.onerror = function() {
            console.error('Error reading image file');
        };
        reader.readAsDataURL(file);
    }

    // Analyze the uploaded image
    async function analyzeSkin() {
        if (isAnalyzing) {
            alert('Please wait for the current analysis to complete');
            return;
        }

        const preview = document.getElementById('image-preview');
        const analyzeBtn = document.getElementById('analyze-btn');
        
        if (!preview || !preview.src || preview.src.startsWith('data:') === false) {
            alert('Please upload an image first');
            return;
        }
        
        if (!analyzeBtn) return;
        
        isAnalyzing = true;
        analyzeBtn.disabled = true;
        analyzeBtn.textContent = "Analyzing...";
        
        try {
            // Check if model is loaded, if not load it
            if (!skinModel && !isModelLoading) {
                await loadSkinModel();
            } else if (isModelLoading) {
                // Wait for model to finish loading
                const maxWaitTime = 10000; // 10 seconds
                const startTime = Date.now();
                while (isModelLoading && (Date.now() - startTime) < maxWaitTime) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                if (isModelLoading) {
                    throw new Error('Model loading timed out');
                }
            }

            // Check if model is still not available
            if (!skinModel) {
                throw new Error('Skin classification model not available');
            }

            // Preprocess the image
            let tensor;
            try {
                tensor = tf.browser.fromPixels(preview)
                    .resizeNearestNeighbor([224, 224])
                    .toFloat()
                    .expandDims();
                
                // Predict (using MobileNet as example - replace with your skin model)
                const predictions = await skinModel.predict(tensor).data();
                
                // Process predictions
                simulateSkinTypeDetection();
            } finally {
                // Clean up TensorFlow.js tensors
                if (tensor) {
                    tensor.dispose();
                }
            }
            
        } catch (error) {
            console.error("Error analyzing image:", error);
            alert("Error analyzing your skin: " + error.message);
            // Fallback to simulated results
            simulateSkinTypeDetection();
        } finally {
            isAnalyzing = false;
            if (analyzeBtn) {
                analyzeBtn.disabled = false;
                analyzeBtn.textContent = "Analyze Skin";
            }
        }
    }

    // Simulate skin type detection (replace with actual model predictions)
    function simulateSkinTypeDetection() {
        const skinTypes = ["Normal", "Dry", "Oily", "Combination", "Sensitive"];
        const weights = [0.2, 0.2, 0.2, 0.3, 0.1]; // Higher weight for Combination
        let randomIndex = 0;
        let randomValue = Math.random();
        
        for (let i = 0; i < weights.length; i++) {
            randomValue -= weights[i];
            if (randomValue <= 0) {
                randomIndex = i;
                break;
            }
        }
        
        const randomType = skinTypes[randomIndex];
        
        const descriptions = {
            "Normal": "Your skin is well-balanced with proper moisture and oil levels.",
            "Dry": "Your skin lacks moisture and may feel tight or flaky.",
            "Oily": "Your skin produces excess oil, especially in the T-zone.",
            "Combination": "Your skin has both oily and dry areas (typically oily T-zone).",
            "Sensitive": "Your skin is prone to irritation and reacts easily to products."
        };
        
        const skinTypeResult = document.getElementById('skin-type-result');
        const skinTypeDescription = document.getElementById('skin-type-description');
        const classificationResults = document.getElementById('classification-results');
        
        if (skinTypeResult) skinTypeResult.textContent = randomType;
        if (skinTypeDescription) skinTypeDescription.textContent = descriptions[randomType];
        if (classificationResults) classificationResults.style.display = 'block';
        
        // Get recommendations for the predicted skin type
        getRecommendationsForSkinType(randomType);
    }

    // Get recommendations based on skin type
    function getRecommendationsForSkinType(skinType) {
        const container = document.getElementById('classified-recommendations');
        if (!container) return;
        
        try {
            // Filter products for the detected skin type
            const filteredProducts = skincareData
                .filter(item => item[skinType] === "1")
                .slice(0, 5);
            
            if (filteredProducts.length === 0) {
                container.innerHTML = "<p>No products found for your skin type. Try adjusting your filters.</p>";
                return;
            }
            
            container.innerHTML = filteredProducts.map(product => {
                const imageUrl = product.picture_src || 'https://via.placeholder.com/100x100?text=No+Image';
                const productUrl = product.product_href || '#';
                const price = product.price || 'Price not available';
                const description = product.description || 'No description available';
                
                return `
                    <div class="recommendation-item">
                        <div class="recommendation-image">
                            <img src="${imageUrl}" alt="${product.product_name}" onerror="this.src='https://via.placeholder.com/100x100?text=No+Image'">
                        </div>
                        <div class="recommendation-content">
                            <h4>${product.product_name || 'Unknown Product'}</h4>
                            <p><strong>Brand:</strong> ${product.brand || 'Unknown Brand'}</p>
                            <p class="recommendation-price"><strong>Price:</strong> ${price}</p>
                            <p>${description}</p>
                            <a href="${productUrl}" target="_blank" rel="noopener noreferrer" style="color: #ff4b4b;">View Product</a>
                        </div>
                    </div>
                `;
            }).join('');
        } catch (error) {
            console.error('Error generating skin type recommendations:', error);
            container.innerHTML = "<p>Error loading recommendations for your skin type.</p>";
        }
    }

    // Set up all event listeners
    function setupEventListeners() {
        // Recommendation tab events
        const categorySelect = document.getElementById('category');
        const skinTypeSelect = document.getElementById('skinType');
        const notableEffectsContainer = document.getElementById('notableEffects');
        const recommendBtn = document.getElementById('recommendBtn');
        
        // Add remove image button handler
        const removeImageBtn = document.getElementById('remove-image-btn');
        if (removeImageBtn) {
            removeImageBtn.addEventListener('click', function() {
                const preview = document.getElementById('image-preview');
                const previewContainer = document.getElementById('image-preview-container');
                const uploadInput = document.getElementById('image-upload');
                
                if (preview && preview.src.startsWith('blob:')) {
                    URL.revokeObjectURL(preview.src);
                }
                if (preview) preview.src = '';
                if (previewContainer) previewContainer.style.display = 'none';
                if (uploadInput) uploadInput.value = '';
            });
        }
        
        if (categorySelect) {
            categorySelect.addEventListener('change', function() {
                updateNotableEffects();
                updateProductList();
            });
        }
        
        if (skinTypeSelect) {
            skinTypeSelect.addEventListener('change', function() {
                updateNotableEffects();
                updateProductList();
            });
        }
        
        if (notableEffectsContainer) {
            notableEffectsContainer.addEventListener('change', function() {
                updateProductList();
            });
        }
        
        if (recommendBtn) {
            recommendBtn.addEventListener('click', generateRecommendations);
        }
        
        // Add sort button handlers
        document.querySelectorAll('.sort-btn').forEach(button => {
            button.addEventListener('click', function() {
                const sortBy = this.getAttribute('data-sort');
                sortRecommendations(sortBy);
            });
        });
        
        // Image error handling
        document.body.addEventListener('error', function(e) {
            if (e.target.tagName.toLowerCase() === 'img') {
                e.target.src = 'https://via.placeholder.com/100x100?text=No+Image';
                e.target.onerror = null; // Prevent infinite loop
            }
        }, true);
        
        // Skin classifier tab events
        const skinClassifierTab = document.querySelector('[data-tab="skin-classifier"]');
        if (skinClassifierTab) {
            skinClassifierTab.addEventListener('click', function() {
                if (!skinModel && !isModelLoading) {
                    loadSkinModel();
                }
            });
        }
        
        const analyzeBtn = document.getElementById('analyze-btn');
        if (analyzeBtn) {
            analyzeBtn.addEventListener('click', analyzeSkin);
        }
        
        // Image upload click handler
        const uploadContainer = document.getElementById('image-upload-container');
        if (uploadContainer) {
            const uploadInput = document.getElementById('image-upload');
            if (uploadInput) uploadInput.addEventListener('change', handleImageUpload);
        }
    }

    // Initialize the app when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Check if Papa Parse is available for CSV parsing
        if (typeof Papa === 'undefined') {
            console.error('Papa Parse library not loaded');
            alert('Error: Required CSV parsing library not loaded. Please try again.');
            return;
        }
        
        // Load CSV data
        loadCSVData();
        
        // Set up image preview error handling
        const imagePreview = document.getElementById('image-preview');
        if (imagePreview) {
            imagePreview.onerror = function() {
                this.src = 'https://via.placeholder.com/300x300?text=No+Image';
            };
        }
    });

    // Add global error handler
    window.addEventListener('error', function(error) {
        console.error('Unhandled error:', error);
        alert('An unexpected error occurred. Please try again.');
    });
</script>
</body>
</html>